---
metaTitle: PersistentStore API Interface
metaDescription: An interface for retrieving and managing persistently stored data.
---

# PersistentStore

<Description>
  An interface for retrieving and managing persistently stored data.
</Description>

The persistent store is a key-value store which is persisted between app restarts intended for small pieces of simple data. If your extension needs to store a large amount of data or individual documents, [register a resource](/docs/extensions/api/core#registerresource) insteasd. Values are automatically namespaced by extension ID in order to prevent seperate extensions from overwiting eachother's data.

The persistent store has two scopes, `global` and `local`.

### Global store

The global store is backed up and synced accross devices when using the Sync add-on. It is intended for data which is not specific to an app installation. For example, internally, MindDrop stores a list of root level topic and tag IDs in the global store.

### Local store

The local store is app specific and is not synced across devices. It is intended for app specific data. For example, internally, MindDrop stores the last opened view and sidebar width in the local store.

## Hooks

Hooks provide access to persistently stored data from inside React components. Unlike data accessed using static methods, hooks will cause the component to rerender when the data changes.

### useGlobalPersistentStore

Returns an object containing all of the data stored by the extension in the global store.

```ts
useGlobalPersistentStore<T>(core: Core): T | undefined
```

<ArgsTable core />

### useGlobalPersistentValue

Returns a value from the global store.

```ts
useGlobalPersistentValue<T>(core: Core, key: string, default?: T): T | undefined
```

<ArgsTable
  core
  data={[
    {
      name: 'key',
      type: 'string',
      required: true,
      description: 'The key of the value to retrieve.',
    },
    {
      name: 'default',
      type: 'any',
      description:
        'The default value returned if the global store value does not exist.',
    },
  ]}
/>

### useLocalPersistentStore

Returns an object containing all of the data stored by the extension in the local store.

```ts
useLocalPersistentStore<T>(core: Core): T | undefined
```

<ArgsTable core />

### useLocalPersistentValue

Returns a value from the local store.

```ts
useLocalPersistentValue<T>(core: Core, key: string, default?: T): T
```

<ArgsTable
  core
  data={[
    {
      name: 'default',
      type: 'any',
      description:
        'The default value returned if the local store value does not exist.',
    },
  ]}
/>

## Static methods

### getGlobalStore

Returns an object containing all of the data stored by the extension in the global store.

```ts
PersistentStore.getGlobalStore<T>(core: Core): T
```

<ArgsTable core />

### getLocalStore

Returns an object containing all of the data stored by the extension in the local store.

```ts
PersistentStore.getLocalStore<T>(core: Core): T
```

<ArgsTable core />

### getGlobalValue

Retrieves a value from the global store.

```ts
PersistentStore.getGlobalValue<T>(core: Core, key: string, default?: T): T
```

<ArgsTable
  core
  data={[
    {
      name: 'key',
      type: 'string',
      required: true,
      description: 'The key of the value to retrieve.',
    },
    {
      name: 'default',
      type: 'any',
      description:
        'The default value returned if the global store value does not exist.',
    },
  ]}
/>

### getLocalValue

Retrieves a value from the local store.

```ts
PersistentStore.getLocalValue<T>(core: Core, key: string, default: T): T
```

<ArgsTable
  core
  data={[
    {
      name: 'key',
      type: 'string',
      required: true,
      description: 'The key of the value to retrieve.',
    },
    {
      name: 'default',
      type: 'any',
      description:
        'The default value returned if the local store value does not exist.',
    },
  ]}
/>

### setGlobalStore

Sets the extension's data in the global store and dispaches a `persistent-store:update-global` event. Useful for initializing the extension's default global store data upon extension activation.

```ts
PersistentStore.setGlobalStore(core: Core, data: Record<string, any>): void
```

<ArgsTable
  core
  data={[
    {
      name: 'data',
      type: 'Record<string, any>',
      required: true,
      description:
        'An object containing the store data. The data values must be serializable into text.',
    },
  ]}
/>

### setLocalStore

Sets the extension's data in the local store and dispaches a `persistent-store:update-local` event. Useful for initializing the extension's default local store data upon extension activation.

```ts
PersistentStore.setLocalStore(core: Core, data: Record<string, any>): void
```

<ArgsTable
  core
  data={[
    {
      name: 'data',
      type: 'Record<string, any>',
      required: true,
      description:
        'An object containing the store data. The data values must be serializable into text.',
    },
  ]}
/>

### setGlobalValue

Sets a value in the global store and dispaches a `persistent-store:update-global` event.

Supports [`FieldValue`](/docs/extensions/api/utils#fieldvalue) mutations.

```ts
PersistentStore.setGlobalValue<T>(core: Core, key: string, value: T): void
```

<ArgsTable
  core
  data={[
    {
      name: 'key',
      type: 'string',
      required: true,
      description: 'The key for which to set the value.',
    },
    {
      name: 'value',
      type: 'any',
      required: true,
      description: 'The data to set. Must be serializable into text.',
    },
  ]}
/>

### setLocalValue

Sets a value in the local store and dispaches a `persistent-store:update-local` event.

Supports [`FieldValue`](/docs/extensions/api/utils#fieldvalue) mutations.

```ts
PersistentStore.setLocalValue<T>(core: Core, key: string, value: T): void
```

<ArgsTable
  core
  data={[
    {
      name: 'key',
      type: 'string',
      required: true,
      description: 'The key for which to set the value.',
    },
    {
      name: 'value',
      type: 'any',
      required: true,
      description: 'The data to set. Must be serializable into text.',
    },
  ]}
/>

### deleteGlobalValue

Deletes a key and assotiated data from the global store. Dispatches a `persistent-store:update-global` event.

```ts
PersistentStore.deleteGlobalValue(core: Core, key: string): void
```

<ArgsTable
  core
  data={[
    {
      name: 'key',
      type: 'string',
      required: true,
      description: 'The key to delete.',
    },
  ]}
/>

### deleteLocalValue

Deletes a key and assotiated data from the local store. Dispatches a `persistent-store:update-local` event.

```ts
PersistentStore.deleteLocalValue(core: Core, key: string): void
```

<ArgsTable
  core
  data={[
    {
      name: 'key',
      type: 'string',
      required: true,
      description: 'The key to delete.',
    },
  ]}
/>

### deleteGlobalStore

Permanently deletes all data added by the extension from the global store. Dispatches a `persistent-store:update-global` event.

```ts
PersistentStore.deleteGlobalStore(core: Core): void
```

<ArgsTable core />

### deleteLocalStore

Permanently deletes all data added by the extension from the local store. Dispatches a `persistent-store:update-local` event.

```ts
PersistentStore.deleteLocalStore(core: Core): void
```

<ArgsTable core />

### clearGlobalCache

Clears all data (including data added by other extensions) from the global store cache. This does not delete the persisted data.

Useful for forcefully refreshing the store from a storage adapter.

```ts
PersistentStore.clearGlobalCache(): void
```

### clearLocalCache

Clears all data (including data added by other extensions) from the local store cache. This does not delete the persisted data.

Useful for forcefully refreshing the store from a storage adapter.

```ts
PersistentStore.clearLocalCache(): void
```

### addEventListener

Adds persistent store specific event listeners. Equivalent to calling `addEventListener` directly on `core`, but provides more advanced type definitions.

```ts
PersistentStore.addEventListener(core: Core, event: PersistentStoreEvent, callback: EventListenerCallback): void
```

<ArgsTable
  core
  data={[
    {
      name: 'event',
      type: 'PersistentStoreEvent',
      required: true,
      description:
        'The event type to listen for. See the tag events section below for available events.',
    },
    {
      name: 'callback',
      type: 'EventListenerCallback',
      required: true,
      description:
        'The callback fired when the event occurs. See the tag events section below for the data passed to the callback.',
    },
  ]}
/>

### removeEventListener

Removes persistent store specific event listeners. Equivalent to calling `removeEventListener` directly on `core`, but provides more advanced type definitions.

```ts
Tags.removeEventListener(core: Core, event: PersistentStoreEvent, callback: EventListenerCallback): void
```

<ArgsTable
  core
  data={[
    {
      name: 'event',
      type: 'PersistentStoreEvent',
      required: true,
      description:
        'The event type for which to remove the event listener.',
    },
    {
      name: 'callback',
      type: 'EventListenerCallback',
      required: true,
      description: 'The callback of the event listener to remove.',
    },
  ]}
/>

## PersistentStore events

<EventsTable
  data={[
    {
      name: 'persistent-store:update-global',
      data: 'UpdateGlobalStoreEventData',
      description: 'Dispatched when the global store is updated.',
    },
    {
      name: 'persistent-store:update-local',
      data: 'UpdateLocalStoreEventData',
      description: 'Dispatched when the local store is updated.',
    },
  ]}
/>

#### UpdateGlobalStoreEventData

<InterfaceTable
  data={[
    {
      name: 'before',
      type: 'PersistentStoreData',
      required: true,
      description: 'Global store data before it was changed.',
    },
    {
      name: 'after',
      type: 'PersistentStoreData',
      required: true,
      description: 'Updated global store data.',
    },
    {
      name: 'changes',
      type: 'PersistentStoreChanges',
      required: true,
      description:
        'The changes made to the global store data. See below for details.',
    },
  ]}
/>

#### UpdateLocalStoreEventData

<InterfaceTable
  data={[
    {
      name: 'before',
      type: 'PersistentStoreData',
      required: true,
      description: 'Local store data before it was changed.',
    },
    {
      name: 'after',
      type: 'PersistentStoreData',
      required: true,
      description: 'Updated local store data.',
    },
    {
      name: 'changes',
      type: 'PersistentStoreChanges',
      required: true,
      description:
        'The changes made to the local store data. See below for details.',
    },
  ]}
/>

`PersistentStoreData`

An object containing key-value pairs namespaced by extension ID.

Example

```ts
data = {
  app: {
    topics: ['topic-1-id', 'topic-2-id'],
    tags: ['tag-id'],
  },
  extensionId: {
    foo: 'bar',
  },
};
```

`PersistentStoreChanges`

An object containing new field values namespaced by the extension ID which caused the update, supports [`FieldValue`](/docs/extensions/api/utils#fieldvalue) mutations.

Example

```ts
changes = {
  extensionId: {
    foo: 'bar',
  },
};
```
